# Лабораторная работа 3. Реализация серверной части на django rest. Документирование API.

## Цель

работы: овладеть практическими навыками реализации серверной части (backend) приложений средствами Django REST framework.

??? note "Вариант 2: Библиотека"

    Создать программную систему, предназначенную для работников библиотеки.
    Такая система должна обеспечивать хранение сведений об имеющихся в библиотеке
    книгах, о читателях библиотеки и читальных залах.
    
    Для каждой книги в БД должны храниться следующие сведения: название книги,
    автор (ы), издательство, год издания, раздел, число экземпляров этой книги в каждом зале
    библиотеки, а также шифр книги и дата закрепления книги за читателем. Книги могут
    перерегистрироваться в другом зале.
    
    Сведения о читателях библиотеки должны включать номер читательского билета,
    ФИО читателя, номер паспорта, дату рождения, адрес, номер телефона, образование,
    наличие ученой степени.
    
    Читатели закрепляются за определенным залом, могут переписаться в другой зал и
    могут записываться и выписываться из библиотеки.
    
    Библиотека имеет несколько читальных залов, которые характеризуются номером,
    названием и вместимостью, то есть количеством людей, которые могут одновременно
    работать в зале.
    
    Библиотека может получать новые книги и списывать старые. Шифр книги может
    измениться в результате переклассификации, а номер читательского билета в результате
    перерегистрации.
    
    Библиотекарю могут потребоваться следующие сведения о текущем состоянии
    библиотеки:
    
    * Какие книги закреплены за заданным читателем?
      * Кто из читателей взял книгу более месяца тому назад?
      * За кем из читателей закреплены книги, количество экземпляров которых в
      библиотеке не превышает 2?
      * Сколько в библиотеке читателей младше 20 лет?
      * Сколько читателей в процентном отношении имеют начальное образование,
      среднее, высшее, ученую степень?
    
    Библиотекарь может выполнять следующие операции:
    
    * Записать в библиотеку нового читателя.
      * Исключить из списка читателей людей, записавшихся в библиотеку более года
      назад и не прошедших перерегистрацию.
      * Списать старую или потерянную книгу.
      * Принять книгу в фонд библиотеки.
    
    Необходимо предусмотреть возможность выдачи отчета о работе библиотеки в
    течение месяца. Отчет должен включать в себя следующую информацию: количество
    книг и читателей на каждый день в каждом из залов и в библиотеке в целом, количество
    читателей, записавшихся в библиотеку в каждый зал и в библиотеку за отчетный месяц.

## Проектирование БД в соот с ТЗ

![WEB Бд.drawio (1).png](assets/lab3/WEB%20%D0%91%D0%B4.drawio%20%281%29.png)

### Для книг (Book + CopyOfBook)

=== "Основные сведения о книгах"
    - **Название книги** - `Book.title`
    - **Автор(ы)** - `Author` + `BookAuthor` (связь M:M)
    - **Издательство** - `Book.publisher`
    - **Год издания** - `Book.publication_year`
    - **Раздел** - `Book.section`
    - **Шифр книги** - `Book.inventory_code`

=== "Учет экземпляров и перемещение"
    - **Число экземпляров в каждом зале** - считается через `CopyOfBook` по `book_id` и `hall_id`
    - **Книги могут перерегистрироваться в другом зале** - изменение `CopyOfBook.hall_id`
    - **Шифр книги может измениться** - изменение `Book.inventory_code`

=== "Операции с фондом"
    - **Библиотека может получать новые книги** - добавление в `Book` и `CopyOfBook`
    - **Списывать старые** - `CopyOfBook.decommission_date` + `Book.is_in_catalog`
    - **Дата закрепления за читателем** - `LoanRecord.issued_at`

### Для читателей (Reader)

=== "Персональные данные"
    - **Номер читательского билета** - `Reader.library_card_id`
    - **ФИО читателя** - `Reader.full_name`
    - **Номер паспорта** - `Reader.passport`
    - **Дата рождения** - `Reader.birth_date`
    - **Адрес** - `Reader.home_address`
    - **Номер телефона** - `Reader.phone_number`

=== "Образование и статус"
    - **Образование, наличие ученой степени** - `Reader.education_level`
    - **Закрепление за определенным залом** - `Reader.hall_id`
    - **Могут записываться и выписываться** - `Reader.is_active_member`

=== "Изменения данных"
    - **Могут переписаться в другой зал** - изменение `Reader.hall_id`
    - **Номер читательского билета может измениться** - изменение `Reader.library_card_id`

### Для читальных залов (ReadingHall)

=== "Характеристики залов"
    - **Номер зала** - `ReadingHall.hall_number`
    - **Название** - `ReadingHall.name`
    - **Вместимость** - `ReadingHall.capacity`

### Для операций библиотекаря

=== "Запросы о текущем состоянии"
    - **Какие книги закреплены за заданным читателем?** - `LoanRecord` + `Book`
    - **Кто из читателей взял книгу более месяца тому назад?** - `LoanRecord.issued_at`
    - **За кем из читателей закреплены редкие книги (≤2 экз.)?** - `CopyOfBook` + `LoanRecord`
    - **Сколько читателей младше 20 лет?** - `Reader.birth_date`
    - **Процент читателей по образованию** - `Reader.education_level`

=== "Основные операции"
    - **Записать нового читателя** - INSERT в `Reader`
    - **Исключить неактивных** - `Reader.last_registration_at` > 1 года
    - **Списать книгу** - `CopyOfBook.decommission_date`
    - **Принять книгу в фонд** - INSERT в `Book`/`CopyOfBook`

### Для отчетов

=== "Статистика и учет"
    - **Количество книг и читателей по залам** - `CopyOfBook` + `Reader` + `ReadingHall`
    - **Количество читателей, записавшихся за месяц** - `Reader.first_registered_at`

### Ограничения значений полей

=== "CopyOfBook.availability_status"
    Возможные значения:
    - `available` - доступен
    - `on_loan` - выдан
    - `reserved` - зарезервирован
    - `decommissioned` - списан

=== "CopyOfBook.copy_condition"
    Возможные значения:
    - `excellent` - отличное
    - `good` - хорошее
    - `fair` - удовлетворительное
    - `poor` - плохое
    - `damaged` - поврежден

=== "Reader.education_level"
    Возможные значения:
    - `primary` - начальное
    - `secondary` - среднее
    - `higher` - высшее
    - `degree` - ученая степень

## Реализация





``` python
http://127.0.0.1:8000/api/reader/18/books/               # 1. Книги читателя
http://127.0.0.1:8000/api/loans/overdue/                 # 2. Просроченные выдачи
http://127.0.0.1:8000/api/readers/rare-books/            # 3. Читатели с редкими книгами
http://127.0.0.1:8000/api/readers/young/                 # 4. Читатели младше 20 лет
http://127.0.0.1:8000/api/stats/education/               # 5. Статистика по образованию
http://127.0.0.1:8000/api/reports/monthly/               # Отчет за месяц
http://127.0.0.1:8000/api/books/                         # Список книг
http://127.0.0.1:8000/api/readers/                       # Список читателей
http://127.0.0.1:8000/api/copies/                        # Список экземпляров
http://127.0.0.1:8000/api/reader/register/               # 6. Регистрация читателя (POST)
http://127.0.0.1:8000/api/readers/remove-inactive/       # 7. Исключение неактивных (POST)
http://127.0.0.1:8000/api/books/decommission/            # 8. Списание книги (POST)
http://127.0.0.1:8000/api/books/add/                     # 9. Добавление книги (POST)
http://127.0.0.1:8000/api/copies/transfer-hall/          # Перемещение книги (POST)
http://127.0.0.1:8000/api/books/20/update-code/          # Изменение шифра (POST)
```
